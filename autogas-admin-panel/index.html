<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli - Kirish</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary-blue: #1b5bb5;
            --secondary-orange: #ed8f36;
            --accent-red: #E30613;
            --dark-gray: #2d3748;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-gray) 50%, var(--accent-red) 100%);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, var(--primary-blue) 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(27, 91, 181, 0.4);
        }
        
        .agu-logo {
            font-family: Arial, sans-serif;
            font-size: 3rem;
            font-weight: 800;
            display: inline-block;
        }
        
        .agu-logo .red-part { 
            color: var(--accent-red); 
        }
        
        .agu-logo .blue-part { 
            color: #0B3373; 
        }
        
        .registered {
            font-size: 1.25rem;
            vertical-align: top;
            color: #0B3373;
        }
        
        .subtitle {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            color: #0B3373;
            margin-top: -8px;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center">
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed top-5 right-5 bg-red-500 text-white py-3 px-6 rounded-lg shadow-lg transform translate-x-[120%] transition-transform duration-500 z-50">
        <span id="toast-message">Xatolik yuz berdi</span>
    </div>
    
    <!-- Login Card -->
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
        
        <!-- Logo -->
        <div class="text-center mb-8">
            <div class="agu-logo">
                <span class="red-part">AG</span><span class="blue-part">U</span><sup class="registered">®</sup>
            </div>
            <div class="subtitle">Auto Gas Uzbekistan</div>
            <h2 class="text-2xl font-bold mt-4 text-gray-800">Admin Paneli</h2>
            <p class="text-gray-600 mt-2">Tizimga kirish uchun ma'lumotlaringizni kiriting</p>
        </div>
        
        <!-- Login Form -->
        <form id="login-form" class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input 
                    type="email" 
                    id="email" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    placeholder="emailingiz@example.com"
                >
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Parol</label>
                <input 
                    type="password" 
                    id="password" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    placeholder="••••••••"
                >
            </div>
            
            <button 
                type="submit" 
                id="login-btn"
                class="w-full btn-primary text-white py-3 rounded-xl font-semibold text-lg"
            >
                Kirish
            </button>
        </form>
        
        <!-- Footer -->
        <div class="mt-6 text-center text-sm text-gray-600">
            <p>Muammo bormi? <a href="#" class="text-blue-600 hover:underline">Yordam</a></p>
        </div>
        
    </div>
    
    <script>
        // API Configuration
        const API_BASE_URL = 'http://127.0.0.1:8000/api';
        
        // Toast function
        function showToast(message, isError = true) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.className = `fixed top-5 right-5 text-white py-3 px-6 rounded-lg shadow-lg transform transition-transform duration-500 z-50 ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            
            toast.classList.remove('translate-x-[120%]');
            toast.classList.add('translate-x-0');
            
            setTimeout(() => {
                toast.classList.remove('translate-x-0');
                toast.classList.add('translate-x-[120%]');
            }, 4000);
        }
        
        // Login Form Handler
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('login-btn');
            
            // Disable button
            loginBtn.disabled = true;
            loginBtn.textContent = 'Yuklanmoqda...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Login xatosi');
                }
                
                // Check user role and redirect accordingly
                if (data.user.role === 'owner') {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    showToast('Xush kelibsiz, ' + data.user.name + '!', false);
                    
                    setTimeout(() => {
                        window.location.href = './owner/dashboard.html';
                    }, 1500);
                    
                } else if (data.user.role === 'admin') {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    showToast('Xush kelibsiz, ' + data.user.name + '!', false);
                    
                    setTimeout(() => {
                        window.location.href = './admin/dashboard.html';
                    }, 1500);
                    
                } else if (data.user.role === 'kontragent') {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    showToast('Xush kelibsiz, ' + data.user.name + '!', false);
                    
                    setTimeout(() => {
                        window.location.href = './kontragent/dashboard.html';
                    }, 1500);
                    
                } else {
                    throw new Error('Ruxsat berilmagan! Admin, Owner yoki Kontragent bo\'lishingiz kerak.');
                }
                
            } catch (error) {
                showToast(error.message);
                loginBtn.disabled = false;
                loginBtn.textContent = 'Kirish';
            }
        });
        
        // Check if already logged in
        window.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (token && user.role) {
                if (user.role === 'owner') {
                    window.location.href = './owner/dashboard.html';
                } else if (user.role === 'admin') {
                    window.location.href = './admin/dashboard.html';
                } else if (user.role === 'kontragent') {
                    window.location.href = './kontragent/dashboard.html';
                }
            }
        });
    </script>
</body>
</html>